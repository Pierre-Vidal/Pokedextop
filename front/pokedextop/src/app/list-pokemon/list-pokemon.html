<div class="container mt-4">
  <!-- Search Bar -->
  <div class="row mb-4">
    <div class="col-md-6 mx-auto">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          placeholder="Rechercher un Pokémon par nom ou type..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
        >
        <button
          class="btn btn-outline-secondary"
          type="button"
          (click)="clearSearch()"
          [disabled]="!searchTerm"
        >
          Effacer
        </button>
      </div>
      <small class="text-muted d-block mt-2">
        {{filteredPokemons.length}} Pokémon(s) trouvé(s)
      </small>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4 mb-4" *ngFor="let pokemon of pokemons">
      <div class="card pokemon-card text-center p-2 position-relative"
           (click)="openDetail(pokemon)">
        <button
          class="btn-toggle position-absolute"
          [class.active]="hasPokemon(+pokemon.id)"
          (click)="togglePokemon(+pokemon.id, $event)"
          title="{{hasPokemon(+pokemon.id) ? 'Dans ma collection' : 'Ajouter à ma collection'}}"
        >
          <span *ngIf="!hasPokemon(+pokemon.id)">+</span>
          <span *ngIf="hasPokemon(+pokemon.id)">✓</span>
        </button>

        <!-- clic sur l'image ouvre détail -->
        <img [src]="pokemon.image"
             class="card-img-top mx-auto pokemon-thumb"
             alt="{{pokemon.name}}"
             (click)="openDetail(pokemon, $event)">

        <div class="card-body">
          <h5 class="card-title">{{pokemon.name}}</h5>
          <p class="card-text">
            Taille: {{ (pokemon.height / 10) | number:'1.1-1' }} m | 
            Poids: {{ (pokemon.weight / 10) | number:'1.1-1' }} kg
          </p>
          <div>
            <span *ngFor="let t of pokemon.type" class="type-badge {{t.toLowerCase()}}">{{t}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="prevPage()">Précédent</button>
      </li>

      <li 
        class="page-item" 
        *ngFor="let page of getPageNumbers()" 
        [class.active]="currentPage === page"
      >
        <button class="page-link" (click)="goToPage(page)">{{page}}</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="nextPage()">Suivant</button>
      </li>
    </ul>
  </nav>
</div>

<!-- Overlay / détail -->
<div class="overlay" *ngIf="selectedPokemon" (click)="closeDetail()">
  <div class="detail-card" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeDetail()" title="Fermer">×</button>
    <div class="row g-0">
      <div class="col-md-5 d-flex align-items-center justify-content-center p-3">
        <img [src]="selectedPokemon.image" alt="{{selectedPokemon.name}}" class="img-fluid large-img">
      </div>
      <div class="col-md-7 p-3">
        <h2>{{selectedPokemon.name}}</h2>
        <div class="mb-2">
          <span *ngFor="let t of selectedPokemon.type" class="type-badge {{t.toLowerCase()}}">{{t}}</span>
        </div>
        <p><strong>Taille :</strong> {{ (selectedPokemon.height / 10) | number:'1.1-1' }} m</p>
        <p><strong>Poids :</strong> {{ (selectedPokemon.weight / 10) | number:'1.1-1' }} kg</p>
        <hr>
        <p *ngIf="selectedPokemon.description; else noDesc">{{selectedPokemon.description}}</p>
        <ng-template #noDesc><p class="text-muted">Aucun descriptif disponible.</p></ng-template>
      </div>
    </div>
  </div>
</div>
